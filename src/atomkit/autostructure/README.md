# AUTOSTRUCTURE Wrapper Module

This module provides a Pythonic interface for generating AUTOSTRUCTURE input files (.dat format) using atomkit Configuration objects.

## What is AUTOSTRUCTURE?

AUTOSTRUCTURE (AS) is a well-established atomic structure code for calculating:
- Energy levels and term structures
- Radiative transition rates
- Autoionization rates
- Photoionization cross sections
- Electron impact excitation
- Dielectronic and radiative recombination

## Key Features

- ✅ **Pythonic Interface**: Generate AS input files with Python methods
- ✅ **Configuration Integration**: Automatic conversion from atomkit `Configuration` objects
- ✅ **Context Manager**: Clean file handling with `with` statements
- ✅ **Type Hints**: Full IDE support and type checking
- ✅ **Comprehensive**: All major AUTOSTRUCTURE namelists supported

## Differences from FAC

| Aspect | AUTOSTRUCTURE | FAC |
|--------|---------------|-----|
| Relativity | Non-relativistic (default) | Fully relativistic |
| Input Format | NAMELIST (Fortran style) | SFAC (Python-like) |
| Configurations | Occupation numbers | String notation |
| Coupling | LS, IC, CA modes | Automatic |
| File Extension | `.dat` | `.sf` |

## Basic Usage

```python
from atomkit.autostructure import ASWriter
from atomkit import Configuration

# Create configurations
ground = Configuration.from_element("C", charge=2)  # Be-like C
excited = ground.generate_excitations(["3s", "3p", "3d"], excitation_level=1)

# Generate AS input file
with ASWriter("c_belike.dat") as asw:
    asw.write_header("Be-like Carbon structure calculation")
    asw.add_blank_line()
    
    # SALGEB: Algebra and configuration setup
    asw.add_salgeb(CUP='IC', RAD='E1')
    
    # Add configurations from atomkit
    asw.configs_from_atomkit(
        [ground] + excited,
        last_core_orbital='1s'  # Treat 1s as closed core
    )
    
    # SMINIM: Radial potential
    asw.add_sminim(NZION=6)  # Carbon Z=6
```

This generates:
```fortran
A.S. Be-like Carbon structure calculation
# Generated by atomkit on 2025-10-16 09:00:00

 &SALGEB CUP='IC' RAD='E1' MXCONF=4 MXVORB=3 &END
 2 0  2 1  3 0
  2    0    0
  1    1    0
  1    0    1
  0    1    1
 &SMINIM NZION=6 &END
```

## Advanced Examples

### With Optimization

```python
with ASWriter("fe_optimized.dat") as asw:
    asw.write_header("Optimized Fe structure")
    asw.add_salgeb(CUP='LS', RAD='E1')
    asw.configs_from_atomkit(configs, last_core_orbital='3p')
    
    # Optimize 6 terms, vary 2 scaling parameters
    asw.add_sminim(NZION=26, INCLUD=6, NLAM=3, NVAR=2)
    # Would then follow with lambda values:
    # 1.0 1.0 1.0
    # 2 3  (which lambdas to vary)
```

### Dielectronic Recombination

```python
with ASWriter("dr_calculation.dat") as asw:
    asw.write_header("DR of Li-like Carbon")
    
    # RUN='DR' for dielectronic recombination
    asw.add_salgeb(RUN='DR', CUP='IC', MXCCF=3)  # 3 autoionizing configs
    
    # N-electron target configs
    asw.configs_from_atomkit(target_configs, last_core_orbital='1s')
    
    # (N+1)-electron autoionizing configs
    asw.configs_from_atomkit(autoion_configs)  # Added after target
    
    # Rydberg series
    asw.add_drr(NMIN=3, NMAX=15, LMIN=0, LMAX=7)
    
    asw.add_sminim(NZION=6)
    asw.add_sradcon(MENG=-15, EMIN=0.0, EMAX=25.0)
```

### Photoionization

```python
with ASWriter("photoion.dat") as asw:
    asw.write_header("PI of Li-like -> He-like")
    
    asw.add_salgeb(RUN='PI', CUP='LS')
    
    # Target: He-like core
    # Continuum: Li-like states
    asw.configs_from_atomkit(target_and_continuum)
    
    asw.add_sminim(NZION=26)
    asw.add_sradcon(MENG=-15, EMIN=0.0, EMAX=1500.0)
```

## NAMELIST Reference

### SALGEB (Required)
Configuration and algebra specification.

**Common Parameters:**
- `CUP`: Coupling scheme ('LS', 'IC', 'CA', 'ICR')
- `RAD`: Radiation type ('E1', 'E2', 'M1', 'ALL')
- `RUN`: Calculation type ('PI', 'DR', 'RR', 'PE', 'RE', 'DE')
- `MXCONF`: Number of configurations (auto-set by `configs_from_atomkit`)
- `MXVORB`: Number of orbitals (auto-set by `configs_from_atomkit`)
- `MXCCF`: Number of (N+1)-electron configs for autoionization
- `KCOR1`, `KCOR2`: Closed core specification

### SMINIM (Required)
Radial potential and minimization.

**Common Parameters:**
- `NZION`: Nuclear charge (>0: TFDA, <0: STO Hartree)
- `INCLUD`: Number of terms in variational minimization
- `NLAM`: Number of scaling parameters
- `NVAR`: Number of variational parameters
- `PRINT`: Output level ('FORM' or 'UNFORM')
- `ORTHOG`: Schmidt orthogonalization ('YES'/'NO')

### SRADCON (Optional)
Continuum energy grid. Needed for autoionization/photoionization.

**Parameters:**
- `MENG`: Number/type of energies (>0: read, <0: generate, =0: auto)
- `EMIN`, `EMAX`: Energy range (Rydbergs)
- `ECORLS`/`ECORIC`: Energy corrections

### DRR (Optional)
Rydberg series for DR/RR. Required when `RUN='DR'/'RR'/'PE'/'RE'`.

**Parameters:**
- `NMIN`, `NMAX`: Principal quantum number range
- `LMIN`, `LMAX`: Angular momentum range
- `NMESH`: Additional n-values for interpolation

## Execution

Generated `.dat` files are executed with the AUTOSTRUCTURE binary:

```bash
as < input.dat > output.log
```

Or redirecting UNIT6 output:

```bash
as < input.dat
# Creates olg, ols, oic, TERMS, LEVELS files
```

## Output Files

AUTOSTRUCTURE creates several output files:
- `olg`: Main output log (UNIT6)
- `ols`: LS-coupling data
- `oic`: Intermediate coupling data
- `TERMS`: Term energy summary
- `LEVELS`: Level energy summary
- `opls`, `opic`: Photoionization data (if applicable)

## Manual Mode

For advanced users, configurations can be specified manually:

```python
with ASWriter("manual.dat") as asw:
    asw.write_header("Manual configuration input")
    asw.add_salgeb(CUP='LS', RAD='E1', MXCONF=3, MXVORB=3)
    
    # Manually specify orbitals (n, l) pairs
    asw.add_orbitals([(1, 0), (2, 0), (2, 1)])  # 1s, 2s, 2p
    
    # Manually specify occupation numbers
    asw.add_configurations([
        [2, 2, 0],  # 1s2.2s2
        [2, 1, 1],  # 1s2.2s1.2p1
        [2, 0, 2],  # 1s2.2p2
    ])
    
    asw.add_sminim(NZION=6)
```

## Further Reading

- AUTOSTRUCTURE manual: See `AS_writeup.txt` in atomkit root
- N.R. Badnell's AUTOSTRUCTURE page: http://www.apap-network.org/autos/
- Original theory: Eissner et al., CPC 8, 270 (1974)
- Collision theory: Badnell, CPC 182, 1528 (2011)

## See Also

- `atomkit.fac.SFACWriter`: Similar wrapper for FAC
- `examples/autostructure_wrapper_demo.py`: Comprehensive examples
- `examples/as_inputs/`: Example AS input files
